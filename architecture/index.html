<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SymPanICH-Net v2 â€” Architecture</title>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0e1a;--surface:#111827;--surface2:#1a2035;--border:#2a3050;--text:#e2e8f0;--text2:#94a3b8;--accent:#6366f1;--accent2:#818cf8;--green:#10b981;--yellow:#f59e0b;--red:#ef4444;--pink:#ec4899;--cyan:#06b6d4;--orange:#f97316;--purple:#a855f7}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;overflow-x:hidden}
.hero{min-height:60vh;display:flex;align-items:center;justify-content:center;text-align:center;padding:4rem 2rem;background:linear-gradient(135deg,#0a0e1a 0%,#1e1b4b 50%,#0f172a 100%);position:relative;overflow:hidden}
.hero::before{content:'';position:absolute;width:600px;height:600px;background:radial-gradient(circle,rgba(99,102,241,.15),transparent 70%);top:-200px;right:-100px;border-radius:50%}
.hero::after{content:'';position:absolute;width:400px;height:400px;background:radial-gradient(circle,rgba(6,182,212,.1),transparent 70%);bottom:-100px;left:-50px;border-radius:50%}
.hero h1{font-size:3.5rem;font-weight:900;background:linear-gradient(135deg,#818cf8,#06b6d4,#10b981);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:.5rem;position:relative;z-index:1}
.hero .subtitle{font-size:1.2rem;color:var(--text2);max-width:700px;margin:0 auto;position:relative;z-index:1}
.hero .version{display:inline-block;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#fff;padding:.3rem 1rem;border-radius:99px;font-weight:600;font-size:.85rem;margin-bottom:1.5rem;position:relative;z-index:1}
.container{max-width:1200px;margin:0 auto;padding:0 2rem}
.nav{position:sticky;top:0;z-index:100;background:rgba(10,14,26,.9);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:.8rem 0}
.nav-inner{display:flex;gap:1rem;overflow-x:auto;padding:.5rem 0;scrollbar-width:none}
.nav-inner::-webkit-scrollbar{display:none}
.nav-btn{padding:.5rem 1rem;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--text2);cursor:pointer;white-space:nowrap;font-size:.8rem;font-family:'Inter';transition:all .3s}
.nav-btn:hover,.nav-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
section{padding:4rem 0}
.section-header{margin-bottom:2.5rem}
.section-header .tag{display:inline-flex;align-items:center;gap:.4rem;background:rgba(99,102,241,.15);color:var(--accent2);padding:.3rem .8rem;border-radius:6px;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;margin-bottom:.8rem}
.section-header h2{font-size:2rem;font-weight:800;margin-bottom:.5rem}
.section-header p{color:var(--text2);max-width:700px}
.card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:2rem;margin-bottom:2rem;transition:transform .3s,box-shadow .3s}
.card:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(0,0,0,.3)}
.card h3{font-size:1.3rem;font-weight:700;margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}
.mermaid{background:var(--surface2);border-radius:12px;padding:1.5rem;margin:1.5rem 0;overflow-x:auto}
table{width:100%;border-collapse:collapse;margin:1rem 0;font-size:.9rem}
th{background:var(--surface2);padding:.7rem 1rem;text-align:left;font-weight:600;border-bottom:2px solid var(--accent)}
td{padding:.6rem 1rem;border-bottom:1px solid var(--border)}
tr:hover td{background:rgba(99,102,241,.05)}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}
.badge{display:inline-block;padding:.2rem .6rem;border-radius:6px;font-size:.75rem;font-weight:600}
.badge-new{background:rgba(16,185,129,.15);color:var(--green)}
.badge-core{background:rgba(99,102,241,.15);color:var(--accent2)}
.report-box{background:linear-gradient(135deg,#1a1a2e,#16213e);border:1px solid #2a3050;border-radius:12px;padding:1.5rem;font-family:'JetBrains Mono',monospace;font-size:.8rem;line-height:1.8;white-space:pre-wrap;color:#a5b4fc;margin:1rem 0}
.report-box .rh{color:var(--cyan);font-weight:700}
.report-box .rv{color:var(--green)}
.report-box .rw{color:var(--yellow)}
.flow-arrow{text-align:center;font-size:2rem;color:var(--accent);margin:1rem 0;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:.4}50%{opacity:1}}
.highlight{background:linear-gradient(135deg,rgba(99,102,241,.1),rgba(6,182,212,.1));border:1px solid rgba(99,102,241,.3);border-radius:12px;padding:1.5rem;margin:1rem 0}
.text-desc{display:grid;gap:.8rem;margin:1rem 0}
.text-desc-item{background:var(--surface2);border-radius:10px;padding:1rem 1.2rem;border-left:3px solid var(--accent);display:flex;gap:1rem;align-items:flex-start}
.text-desc-item .icon{font-size:1.5rem;flex-shrink:0}
.text-desc-item strong{display:block;margin-bottom:.2rem}
.text-desc-item span{color:var(--text2);font-size:.85rem;font-style:italic}
.phase-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin:1rem 0}
.phase{border-radius:12px;padding:1.2rem;text-align:center}
.phase h4{font-size:.9rem;margin-bottom:.5rem}
.phase p{font-size:.75rem;color:var(--text2)}
.p1{background:rgba(99,102,241,.1);border:1px solid rgba(99,102,241,.3)}
.p2{background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.3)}
.p3{background:rgba(245,158,11,.1);border:1px solid rgba(245,158,11,.3)}
.p4{background:rgba(236,72,153,.1);border:1px solid rgba(236,72,153,.3)}
.metric-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin:1rem 0}
.metric-card{background:var(--surface2);border-radius:12px;padding:1.2rem;text-align:center;border:1px solid var(--border)}
.metric-card .val{font-size:1.8rem;font-weight:800;background:linear-gradient(135deg,var(--accent2),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.metric-card .label{font-size:.75rem;color:var(--text2);margin-top:.3rem}
.divider{height:1px;background:linear-gradient(90deg,transparent,var(--border),transparent);margin:3rem 0}
footer{text-align:center;padding:3rem 2rem;color:var(--text2);font-size:.85rem;border-top:1px solid var(--border)}
@media(max-width:768px){.hero h1{font-size:2rem}.grid2,.phase-grid{grid-template-columns:1fr}.metric-grid{grid-template-columns:1fr 1fr}}
</style>
</head>
<body>

<!-- HERO -->
<div class="hero">
  <div>
    <div class="version">v2.0 â€” Text-Guided + AI Analysis</div>
    <h1>ğŸ§  SymPanICH-Net</h1>
    <p class="subtitle">Text-Guided Symmetry-Aware Panoptic Segmentation with AI Clinical Analysis for Intracranial Hemorrhage Detection on Brain CT</p>
  </div>
</div>

<!-- NAV -->
<div class="nav"><div class="container"><div class="nav-inner">
  <button class="nav-btn active" onclick="scrollTo_('#overview')">Overview</button>
  <button class="nav-btn" onclick="scrollTo_('#m1')">M1: Input</button>
  <button class="nav-btn" onclick="scrollTo_('#m2')">M2: Backbone</button>
  <button class="nav-btn" onclick="scrollTo_('#m3')">M3: Symmetry</button>
  <button class="nav-btn" onclick="scrollTo_('#m4')">M4: FPN</button>
  <button class="nav-btn" onclick="scrollTo_('#m5')">M5: Panoptic</button>
  <button class="nav-btn" onclick="scrollTo_('#m6')">M6: HoVer</button>
  <button class="nav-btn" onclick="scrollTo_('#m7')">M7: Text Encoder</button>
  <button class="nav-btn" onclick="scrollTo_('#m8')">M8: AI Report</button>
  <button class="nav-btn" onclick="scrollTo_('#losses')">Losses</button>
  <button class="nav-btn" onclick="scrollTo_('#training')">Training</button>
  <button class="nav-btn" onclick="scrollTo_('#results')">Results</button>
</div></div></div>

<div class="container">

<!-- OVERVIEW -->
<section id="overview">
  <div class="section-header">
    <div class="tag">ğŸ“ Full Pipeline</div>
    <h2>Complete 8-Module Architecture</h2>
    <p>From raw CT scan to panoptic segmentation + AI-generated clinical report</p>
  </div>
  <div class="card">
    <div class="mermaid">
flowchart TB
    subgraph A["ğŸ“¥ M1 â€” Input"]
        CT["ğŸ©» CT Volume"] ==>|"window"| WIN["Multi-Window"] ==>|"2.5D"| AUG["Augment"] ==>|"orig"| ORIG["Original"]
        AUG ==>|"flip"| FLIP["Flipped"]
    end
    subgraph B["ğŸ¦´ M2 â€” Backbone"]
        ORIG ==>|"forward"| SW_O["Swin-T V2"] ==>|"4 scales"| FO["F_orig"]
        FLIP ==>|"shared wt"| SW_F["Swin-T V2"] ==>|"4 scales"| FF["F_flip"]
    end
    subgraph C["ğŸ”„ M3 â€” Symmetry"]
        FO ==>|"Q"| SCA["SACA"]
        FF ==>|"K,V"| SCA
        SCA ==>|"gate"| SYM["F_sym"]
    end
    subgraph D["ğŸ“ M4 â€” FPN"]
        SYM ==>|"lateral"| FPN["FPN"] ==>|"fuse"| MS["P1â€“P4"]
    end
    subgraph G["ğŸ“ M7 â€” Text Encoder"]
        TXT["Clinical\nDescriptions"] ==>|"encode"| BIO["BiomedCLIP"] ==>|"embed"| TE["T âˆˆ â„â¶Ë£Â²âµâ¶"]
    end
    subgraph E["ğŸ­ M5 â€” Panoptic Head"]
        MS ==>|"deform attn"| PD["Pixel Decoder"] ==>|"pixels"| MF["Per-Pixel Emb"]
        TE ==>|"text guide"| XA["Cross-Modal Attn"]
        MF ==>|"visual"| XA ==>|"fused"| TD["Transformer Dec\n50 queries"] ==>|"cls"| CLS["Classes (7)"]
        TD ==>|"seg"| MSK["Masks (N)"]
    end
    subgraph F["ğŸ“ M6 â€” HoVer"]
        MF ==>|"regress"| HV["H/V Maps"]
    end
    subgraph H["ğŸ¤– M8 â€” AI Report"]
        CLS ==>|"preds"| VP["Feature Pool"]
        MSK ==>|"masks"| VP
        TE ==>|"context"| VP ==>|"prompt"| LLM["BioMistral"] ==>|"gen"| RPT["ğŸ“‹ Report"]
    end
    subgraph OUT["ğŸ“¤ Output"]
        CLS ==>|"logits"| FUS["Fusion"]
        MSK ==>|"masks"| FUS
        HV ==>|"refine"| FUS ==>|"merge"| PAN["ğŸ¯ Panoptic Map"]
    end
    style A fill:#1e3a5f,stroke:#3b82f6,stroke-width:2px,color:#e2e8f0
    style B fill:#1a3d2e,stroke:#22c55e,stroke-width:2px,color:#e2e8f0
    style C fill:#3d3a1a,stroke:#eab308,stroke-width:2px,color:#e2e8f0
    style D fill:#3d2a1a,stroke:#f97316,stroke-width:2px,color:#e2e8f0
    style E fill:#2d1a3d,stroke:#a855f7,stroke-width:2px,color:#e2e8f0
    style F fill:#3d1a1a,stroke:#ef4444,stroke-width:2px,color:#e2e8f0
    style G fill:#1a3d3d,stroke:#06b6d4,stroke-width:2px,color:#e2e8f0
    style H fill:#3d1a2d,stroke:#ec4899,stroke-width:2px,color:#e2e8f0
    style OUT fill:#1a3d35,stroke:#14b8a6,stroke-width:2px,color:#e2e8f0
    </div>
  </div>
</section>

<!-- MODULE 1 -->
<section id="m1">
  <div class="section-header">
    <div class="tag">ğŸ“¥ Module 1</div>
    <h2>Multi-Window 2.5D Input Pipeline</h2>
    <p>Different CT windows reveal different anatomy â€” a single window misses critical information</p>
  </div>
  <div class="card">
    <div class="mermaid">
flowchart LR
    RAW["Raw CT\n(HU values)"] ==>|"window 1"| BW["Brain\nC=40 W=80"]
    RAW ==>|"window 2"| SW["Subdural\nC=75 W=215"]
    RAW ==>|"window 3"| BONE["Bone\nC=600 W=2800"]
    BW ==>|"ch 1"| STACK["Stack â†’ 3ch\n(HÃ—WÃ—3)"]
    SW ==>|"ch 2"| STACK
    BONE ==>|"ch 3"| STACK
    STACK ==>|"Â±2 slices"| CTX["2.5D Context\n(15ch â†’ 3ch)"]
    CTX ==>|"augment"| ORIG["Original"] & FLIP["Flipped"]
    style RAW fill:#1e3a5f,stroke:#3b82f6,color:#e2e8f0
    style STACK fill:#1a3d3d,stroke:#06b6d4,color:#e2e8f0
    </div>
    <table>
      <tr><th>Window</th><th>Center (HU)</th><th>Width (HU)</th><th>Reveals</th></tr>
      <tr><td>Brain</td><td>40</td><td>80</td><td>Gray/white matter, large bleeds</td></tr>
      <tr><td>Subdural</td><td>75</td><td>215</td><td>Subdural & epidural near skull</td></tr>
      <tr><td>Bone</td><td>600</td><td>2800</td><td>Skull fractures, calcifications</td></tr>
    </table>
  </div>
</section>

<!-- MODULE 2 -->
<section id="m2">
  <div class="section-header">
    <div class="tag">ğŸ¦´ Module 2</div>
    <h2>Dual-Stream Swin Transformer V2 Backbone</h2>
    <p>Shared-weight backbone processes original and flipped images to extract multi-scale features</p>
  </div>
  <div class="card">
    <div class="mermaid">
flowchart TB
    ORIG["Original\n256Ã—256Ã—3"] ==>|"patch embed"| S1O["Stage 1\n2Ã—STB Â· 64Ã—64Ã—96"] ==>|"merge"| S2O["Stage 2\n2Ã—STB Â· 32Ã—32Ã—192"] ==>|"merge"| S3O["Stage 3\n6Ã—STB Â· 16Ã—16Ã—384"] ==>|"merge"| S4O["Stage 4\n2Ã—STB Â· 8Ã—8Ã—768"]
    S1O -.->|"F1"| O1["1/4 scale"]
    S2O -.->|"F2"| O2["1/8 scale"]
    S3O -.->|"F3"| O3["1/16 scale"]
    S4O -.->|"F4"| O4["1/32 scale"]
    style ORIG fill:#1a3d2e,stroke:#22c55e,color:#e2e8f0
    style S1O fill:#1a3d2e,stroke:#22c55e,color:#e2e8f0
    style S2O fill:#1a3d2e,stroke:#22c55e,color:#e2e8f0
    style S3O fill:#1a3d2e,stroke:#22c55e,color:#e2e8f0
    style S4O fill:#1a3d2e,stroke:#22c55e,color:#e2e8f0
    </div>
    <table>
      <tr><th>Parameter</th><th>Value</th></tr>
      <tr><td>Patch size</td><td>4Ã—4</td></tr>
      <tr><td>Embed dim (C)</td><td>96</td></tr>
      <tr><td>Depths</td><td>[2, 2, 6, 2]</td></tr>
      <tr><td>Attention heads</td><td>[3, 6, 12, 24]</td></tr>
      <tr><td>Window size</td><td>8</td></tr>
      <tr><td>Parameters</td><td>~28M</td></tr>
      <tr><td>Pretrained</td><td>ImageNet-22K</td></tr>
    </table>
  </div>
</section>

<!-- MODULE 3 -->
<section id="m3">
  <div class="section-header">
    <div class="tag">ğŸ”„ Module 3 â€” Key Novelty</div>
    <h2>Symmetry-Aware Cross-Attention (SACA)</h2>
    <p>Learns which asymmetries are clinically meaningful â€” far more powerful than simple subtraction</p>
  </div>
  <div class="card">
    <div class="mermaid">
flowchart TB
    FO["F_orig\n(HÃ—WÃ—C)"] ==>|"linearâ†’Q"| Q["Query"]
    FF["F_flip\n(HÃ—WÃ—C)"] ==>|"linearâ†’K"| K["Key"]
    FF ==>|"linearâ†’V"| V["Value"]
    Q ==>|"QÂ·Káµ€/âˆšd"| ATTN["Multi-Head\nCross-Attention"] 
    K ==>|"sim"| ATTN
    V ==>|"agg"| ATTN ==>|"asymmetry"| ASYM["Asym Features"]
    FO ==>|"subtract"| DIFF["F_orig âˆ’ F_flip"]
    FF ==>|"subtract"| DIFF ==>|"|abs|"| ABS["|Diff|"] ==>|"Ïƒ(WÂ·x)"| GATE["Gate g âˆˆ [0,1]"]
    FO ==>|"Ã—(1âˆ’g)"| BLEND["Gated Blend"]
    ASYM ==>|"Ã—g"| BLEND
    GATE ==>|"control"| BLEND ==>|"output"| OUT["F_sym"]
    style FO fill:#3d3a1a,stroke:#eab308,color:#e2e8f0
    style FF fill:#3d3a1a,stroke:#eab308,color:#e2e8f0
    style OUT fill:#3d3a1a,stroke:#eab308,color:#e2e8f0
    </div>
    <div class="highlight">
      <strong>Formula:</strong><br>
      <code>g = Ïƒ(W Â· |F_orig âˆ’ F_flip|)</code><br>
      <code>F_sym = (1 âˆ’ g) Â· F_orig + g Â· CrossAttn(Q, K, V)</code><br><br>
      <em>When g â‰ˆ 0 â†’ normal region (keep original) | When g â‰ˆ 1 â†’ hemorrhage detected (use asymmetry info)</em>
    </div>
  </div>
</section>

<!-- MODULE 4 -->
<section id="m4">
  <div class="section-header">
    <div class="tag">ğŸ“ Module 4</div>
    <h2>Feature Pyramid Network (FPN)</h2>
    <p>Connects multi-scale features for detecting hemorrhages at all sizes</p>
  </div>
  <div class="card">
    <div class="mermaid">
flowchart TB
    F4["F4_sym\n8Ã—8Ã—768"] ==>|"1Ã—1 Conv"| L4["C4 256ch"] ==>|"3Ã—3"| P4["P4 (1/32)"]
    L4 ==>|"â†‘2Ã—"| A3["âŠ•"]
    F3["F3_sym\n16Ã—16Ã—384"] ==>|"1Ã—1 Conv"| L3["C3"] ==>|"add"| A3 ==>|"3Ã—3"| P3["P3 (1/16)"]
    A3 ==>|"â†‘2Ã—"| A2["âŠ•"]
    F2["F2_sym\n32Ã—32Ã—192"] ==>|"1Ã—1 Conv"| L2["C2"] ==>|"add"| A2 ==>|"3Ã—3"| P2["P2 (1/8)"]
    A2 ==>|"â†‘2Ã—"| A1["âŠ•"]
    F1["F1_sym\n64Ã—64Ã—96"] ==>|"1Ã—1 Conv"| L1["C1"] ==>|"add"| A1 ==>|"3Ã—3"| P1["P1 (1/4)"]
    style P1 fill:#3d2a1a,stroke:#f97316,color:#e2e8f0
    style P2 fill:#3d2a1a,stroke:#f97316,color:#e2e8f0
    style P3 fill:#3d2a1a,stroke:#f97316,color:#e2e8f0
    style P4 fill:#3d2a1a,stroke:#f97316,color:#e2e8f0
    </div>
  </div>
</section>

<!-- MODULE 5 -->
<section id="m5">
  <div class="section-header">
    <div class="tag">ğŸ­ Module 5</div>
    <h2>Mask2Former Panoptic Head + Text Fusion</h2>
    <p>Transformer decoder with cross-modal text-vision attention for text-guided segmentation</p>
  </div>
  <div class="card">
    <h3>ğŸ­ Pixel Decoder â†’ Transformer Decoder</h3>
    <div class="mermaid">
flowchart TB
    P1["P1(1/4)"] & P2["P2(1/8)"] & P3["P3(1/16)"] & P4["P4(1/32)"] ==>|"multi-scale"| DEFORM["Deformable\nAttention (3 layers)"] ==>|"per-pixel"| PPE["Per-Pixel Emb\n(H/4Ã—W/4Ã—256)"]
    TE["Text Emb\nTâˆˆâ„â¶Ë£Â²âµâ¶"] ==>|"text K,V"| XMA["Cross-Modal\nAttention"]
    PPE ==>|"visual Q"| XMA ==>|"text-guided"| TGF["Text-Guided\nFeatures"]
    TGF ==>|"input"| TD["Transformer Dec\n9 layers Â· 50 queries"]
    TD ==>|"classify"| CLS["Class Pred (NÃ—7)"]
    TD ==>|"embed"| ME["Mask Emb (NÃ—256)"] ==>|"dot product"| MASKS["N Binary Masks"]
    PPE ==>|"per-pixel"| MASKS
    style XMA fill:#2d1a3d,stroke:#a855f7,color:#e2e8f0
    style TE fill:#1a3d3d,stroke:#06b6d4,color:#e2e8f0
    </div>
  </div>
  <div class="card">
    <h3>ğŸ”— Cross-Modal Text-Vision Attention Detail</h3>
    <div class="mermaid">
flowchart TB
    VIS["Visual V\n(HÃ—WÃ—256)"] ==>|"Q=Linear(V)"| Q["Query"]
    TXT["Text T\n(6Ã—256)"] ==>|"K=Linear(T)"| K["Key"]
    TXT ==>|"V=Linear(T)"| V2["Value"]
    Q & K ==>|"QÂ·Káµ€/âˆšD"| SC["Scores (HÃ—WÃ—6)"] ==>|"softmax"| W["Weights Î±"]
    W & V2 ==>|"Î±Â·V"| TG["Text-Guided Feat"]
    VIS ==>|"residual +"| ADD["âŠ•"]
    TG ==>|"weighted"| ADD ==>|"LayerNorm"| OUT["V' (HÃ—WÃ—256)"]
    style OUT fill:#2d1a3d,stroke:#a855f7,color:#e2e8f0
    </div>
    <div class="highlight">
      <strong>Each pixel attends to ALL 6 hemorrhage descriptions â†’</strong> Pixels matching <em>"crescent-shaped hyperdense collection"</em> get high attention to the Subdural embedding. Acts as a <strong>learned clinical prior</strong>.
    </div>
  </div>
</section>

<!-- MODULE 6 -->
<section id="m6">
  <div class="section-header">
    <div class="tag">ğŸ“ Module 6</div>
    <h2>HoVer-Net Distance Branch</h2>
    <p>Separates adjacent bleed instances using horizontal/vertical distance maps</p>
  </div>
  <div class="card">
    <div class="mermaid">
flowchart TB
    PPE["Per-Pixel Emb"] ==>|"3Ã—3 Conv"| C1["256â†’128 + BN+ReLU"] ==>|"3Ã—3 Conv"| C2["128â†’64 + BN+ReLU"]
    C2 ==>|"1Ã—1"| HM["H-Map (1ch)"]
    C2 ==>|"1Ã—1"| VM["V-Map (1ch)"]
    HM ==>|"Sobel"| GH["âˆ‡H"]
    VM ==>|"Sobel"| GV["âˆ‡V"]
    GH & GV ==>|"high gradient"| BD["Instance\nBoundaries"] ==>|"watershed"| REF["Refine Masks"]
    style BD fill:#3d1a1a,stroke:#ef4444,color:#e2e8f0
    </div>
  </div>
</section>

<!-- MODULE 7 â€” NEW -->
<section id="m7">
  <div class="section-header">
    <div class="tag">ğŸ“ Module 7 <span class="badge badge-new">NEW</span></div>
    <h2>Text Encoder â€” Clinical Hemorrhage Descriptions</h2>
    <p>BiomedCLIP encodes radiologist-written descriptions of each hemorrhage type's CT appearance</p>
  </div>
  <div class="card">
    <h3>ğŸ“š Clinical Text Descriptions</h3>
    <div class="text-desc">
      <div class="text-desc-item"><div class="icon">ğŸŸ¢</div><div><strong>Intraventricular</strong><span>"Hyperdense fluid collection within the ventricular system, often with fluid-fluid levels and ventricular enlargement. Appears bright white inside ventricles."</span></div></div>
      <div class="text-desc-item"><div class="icon">ğŸŸ¡</div><div><strong>Intraparenchymal</strong><span>"Well-defined hyperdense lesion within brain parenchyma, round/oval shape, surrounded by low-density perilesional edema ring creating a halo effect."</span></div></div>
      <div class="text-desc-item"><div class="icon">ğŸŸ£</div><div><strong>Subarachnoid</strong><span>"Hyperdense material filling sulci and cisterns, following contour of brain surface. Star-shaped pattern in basal cisterns. Thin linear densities."</span></div></div>
      <div class="text-desc-item"><div class="icon">ğŸ”µ</div><div><strong>Epidural</strong><span>"Biconvex lens-shaped hyperdense collection between skull inner table and dura mater. Does not cross suture lines. Smooth inner margin."</span></div></div>
      <div class="text-desc-item"><div class="icon">ğŸ”´</div><div><strong>Subdural</strong><span>"Crescent-shaped hyperdense collection along brain convexity, crosses suture lines, follows dural reflections. May cause midline shift."</span></div></div>
      <div class="text-desc-item"><div class="icon">â¬œ</div><div><strong>Ambiguous</strong><span>"Ill-defined hyperdense region with mixed density patterns, unclear boundaries between adjacent hemorrhage types. May represent evolving bleed."</span></div></div>
    </div>
  </div>
  <div class="card">
    <h3>ğŸ”¤ BiomedCLIP Encoding Pipeline</h3>
    <div class="mermaid">
flowchart LR
    T1["ğŸŸ¢ IVH text"] & T2["ğŸŸ¡ IPH text"] & T3["ğŸŸ£ SAH text"] & T4["ğŸ”µ EDH text"] & T5["ğŸ”´ SDH text"] & T6["â¬œ AMB text"] ==>|"tokenize"| TOK["PubMedBERT\nTokenizer"] ==>|"encode"| BERT["Transformer\n12 layers"] ==>|"[CLS] pool"| PROJ["Linear\nâ†’ 256 dims"]
    PROJ ==>|"stack"| MAT["T âˆˆ â„â¶Ë£Â²âµâ¶"]
    style TOK fill:#1a3d3d,stroke:#06b6d4,color:#e2e8f0
    style BERT fill:#1a3d3d,stroke:#06b6d4,color:#e2e8f0
    style MAT fill:#1a3d3d,stroke:#06b6d4,color:#e2e8f0
    </div>
    <div class="highlight">
      <strong>Why BiomedCLIP?</strong> Pretrained on <strong>15M biomedical image-text pairs</strong> from PubMed â€” understands medical terms like <em>"hyperdense"</em>, <em>"sulci"</em>, <em>"cisterns"</em>, and CT-specific concepts. Generic CLIP would fail here.
    </div>
  </div>
</section>

<!-- MODULE 8 â€” NEW -->
<section id="m8">
  <div class="section-header">
    <div class="tag">ğŸ¤– Module 8 <span class="badge badge-new">NEW</span></div>
    <h2>AI Clinical Report Generator</h2>
    <p>Generates structured diagnostic reports from segmentation outputs â€” mimicking a radiologist</p>
  </div>
  <div class="card">
    <h3>ğŸ§  Report Generation Pipeline</h3>
    <div class="mermaid">
flowchart TB
    CLS["Class Preds\n(type+conf)"] ==>|"detected"| ROI["ROI Feature Pool"]
    MSK["Instance Masks\n(loc,size)"] ==>|"regions"| ROI
    ROI ==>|"stats"| STATS["Compute:\nsize, location,\nshape metrics"]
    TE["Text Emb"] ==>|"match"| MATCH["Text-Visual\nSimilarity"]
    STATS ==>|"metrics"| MATCH
    MATCH ==>|"findings"| STRUCT["Structured\nFinding Builder"]
    MATCH ==>|"volume"| SEV["Severity\nClassifier"]
    MATCH ==>|"centroids"| SPAT["Spatial\nAnalyzer"]
    META["Scan Metadata"] & STRUCT & SEV & SPAT ==>|"assemble"| PROMPT["Prompt\nAssembler"] ==>|"generate"| LLM["BioMistral-7B\n(LoRA)"] ==>|"output"| RPT["ğŸ“‹ Clinical Report"]
    style LLM fill:#3d1a2d,stroke:#ec4899,color:#e2e8f0
    style RPT fill:#3d1a2d,stroke:#ec4899,color:#e2e8f0
    </div>
  </div>
  <div class="card">
    <h3>ğŸ“‹ Example AI Report</h3>
    <div class="report-box"><span class="rh">ğŸ¥ SymPanICH-Net v2 â€” AI Clinical Report</span>

<span class="rh">ğŸ“‹ FINDINGS SUMMARY</span>
Two hemorrhagic foci identified in axial slice #24.
Primary: Right subdural hematoma
Secondary: Left subarachnoid hemorrhage

<span class="rh">ğŸ” TYPE & APPEARANCE</span>
<span class="rv">1. Subdural Hematoma (Confidence: 94.2%)</span>
   â€¢ Crescent-shaped hyperdense collection
   â€¢ Along right frontoparietal convexity
   â€¢ Maximum thickness: 12mm
   â€¢ Crosses coronal suture (confirmed subdural)

<span class="rv">2. Subarachnoid Hemorrhage (Confidence: 87.6%)</span>
   â€¢ Hyperdense material in left Sylvian fissure
   â€¢ Linear pattern following sulci
   â€¢ Estimated volume: 3mL

<span class="rw">âš ï¸ SEVERITY: MODERATE</span>
Combined volume: ~28mL | Midline shift: 3mm (rightward)

<span class="rh">ğŸ“ ANATOMICAL LOCATION</span>
Laterality: Bilateral (R > L)
Regions: Right frontoparietal, Left Sylvian

<span class="rh">âœ… RECOMMENDED ACTIONS</span>
â€¢ Urgent neurosurgical consultation
â€¢ Repeat CT in 6 hours to assess progression
â€¢ Monitor GCS and neurological status
â€¢ Consider surgical evacuation if midline shift > 5mm</div>
  </div>
  <div class="card">
    <h3>âš–ï¸ Severity Classification</h3>
    <table>
      <tr><th>Metric</th><th>Mild</th><th>Moderate</th><th>Severe</th></tr>
      <tr><td>Volume</td><td>&lt; 10 mL</td><td>10â€“30 mL</td><td>&gt; 30 mL</td></tr>
      <tr><td>Midline Shift</td><td>&lt; 2 mm</td><td>2â€“5 mm</td><td>&gt; 5 mm</td></tr>
      <tr><td># of Types</td><td>Single</td><td>2 types</td><td>3+ types</td></tr>
      <tr><td>Location</td><td>Peripheral</td><td>Intermediate</td><td>Deep/brainstem</td></tr>
    </table>
  </div>
</section>

<div class="divider"></div>

<!-- LOSSES -->
<section id="losses">
  <div class="section-header">
    <div class="tag">âš–ï¸ Loss Functions</div>
    <h2>Training Objectives (with Text Alignment)</h2>
  </div>
  <div class="card">
    <div class="mermaid">
flowchart LR
    subgraph SEG["Segmentation"]
        L1["L_cls\nFocal CE\nw=2.0"] & L2["L_dice\nw=5.0"] & L3["L_mask_focal\nw=5.0"]
    end
    subgraph AUX["Auxiliary"]
        L4["L_hv\nMSE\nw=1.0"] & L5["L_deep\nSupervision\nw=1.0"]
    end
    subgraph TXT["ğŸ†• Text Alignment"]
        L6["L_contrastive\nInfoNCE\nw=0.5"] & L7["L_text_cls\nConsistency\nw=0.3"]
    end
    L1 & L2 & L3 & L4 & L5 & L6 & L7 ==>|"Î£"| TOTAL["L_total"]
    style TXT fill:#1a3d3d,stroke:#06b6d4,color:#e2e8f0
    </div>
    <table>
      <tr><th>Loss</th><th>Weight</th><th>Purpose</th></tr>
      <tr><td>L_cls (Focal CE)</td><td>2.0</td><td>Class imbalance handling</td></tr>
      <tr><td>L_dice</td><td>5.0</td><td>Overlap for varying sizes</td></tr>
      <tr><td>L_mask_focal</td><td>5.0</td><td>Pixel-level hard examples</td></tr>
      <tr><td>L_hv (MSE)</td><td>1.0</td><td>Distance map regression</td></tr>
      <tr><td>L_deep</td><td>1.0</td><td>Deep supervision at layers 3, 6</td></tr>
      <tr><td><strong>L_contrastive</strong> ğŸ†•</td><td>0.5</td><td>Visual â†” text alignment (InfoNCE)</td></tr>
      <tr><td><strong>L_text_cls</strong> ğŸ†•</td><td>0.3</td><td>Text-similarity classification consistency</td></tr>
    </table>
  </div>
</section>

<!-- TRAINING -->
<section id="training">
  <div class="section-header">
    <div class="tag">ğŸ‹ï¸ Training Strategy</div>
    <h2>4-Phase Training Pipeline</h2>
  </div>
  <div class="card">
    <div class="phase-grid">
      <div class="phase p1"><h4>Phase 1 (Ep 1â€“5)</h4><p>Warmup â€” backbone & text encoder frozen, only heads train, LR: 0â†’1e-4</p></div>
      <div class="phase p2"><h4>Phase 2 (Ep 6â€“60)</h4><p>Full training â€” all unfrozen, backbone LR=1e-5, head=1e-4, text=5e-6</p></div>
      <div class="phase p3"><h4>Phase 3 (Ep 61â€“90)</h4><p>Fine-tune â€” lower LRs, stronger augmentation, early stopping</p></div>
      <div class="phase p4"><h4>Phase 4 (Ep 91â€“100)</h4><p>ğŸ†• Report tuning â€” freeze seg, LoRA on BioMistral, report quality loss</p></div>
    </div>
    <table>
      <tr><th>Setting</th><th>Value</th></tr>
      <tr><td>Optimizer</td><td>AdamW</td></tr>
      <tr><td>Base LR</td><td>1e-4</td></tr>
      <tr><td>Backbone LR</td><td>1e-5 (0.1Ã—)</td></tr>
      <tr><td>Weight Decay</td><td>0.05</td></tr>
      <tr><td>Batch Size</td><td>4 (Ã—4 grad accum = effective 16)</td></tr>
      <tr><td>Epochs</td><td>100 (early stop patience=15)</td></tr>
      <tr><td>Mixed Precision</td><td>FP16 (AMP)</td></tr>
      <tr><td>Validation</td><td>5-fold Cross-Validation</td></tr>
    </table>
  </div>
</section>

<!-- RESULTS -->
<section id="results">
  <div class="section-header">
    <div class="tag">ğŸ“Š Expected Results</div>
    <h2>Performance Comparison</h2>
  </div>
  <div class="card">
    <h3>ğŸ“ˆ v2 Expected Metrics</h3>
    <div class="metric-grid">
      <div class="metric-card"><div class="val">0.85â€“0.89</div><div class="label">Dice Score</div></div>
      <div class="metric-card"><div class="val">0.74â€“0.80</div><div class="label">IoU</div></div>
      <div class="metric-card"><div class="val">0.85â€“0.90</div><div class="label">Recall</div></div>
      <div class="metric-card"><div class="val">0.83â€“0.88</div><div class="label">Precision</div></div>
      <div class="metric-card"><div class="val">0.58â€“0.68</div><div class="label">Panoptic Quality</div></div>
      <div class="metric-card"><div class="val">0.3â€“0.4</div><div class="label">Report BLEU</div></div>
    </div>
    <table>
      <tr><th>Metric</th><th>Baseline</th><th>v1</th><th>v2 (Text+AI)</th></tr>
      <tr><td>Dice</td><td>0.625</td><td>0.82â€“0.86</td><td><strong>0.85â€“0.89</strong></td></tr>
      <tr><td>IoU</td><td>0.460</td><td>0.70â€“0.76</td><td><strong>0.74â€“0.80</strong></td></tr>
      <tr><td>Precision</td><td>0.685</td><td>0.80â€“0.85</td><td><strong>0.83â€“0.88</strong></td></tr>
      <tr><td>Recall</td><td>0.610</td><td>0.82â€“0.88</td><td><strong>0.85â€“0.90</strong></td></tr>
      <tr><td>PQ</td><td>N/A</td><td>0.55â€“0.65</td><td><strong>0.58â€“0.68</strong></td></tr>
    </table>
  </div>
  <div class="card">
    <h3>ğŸ›  Tech Stack</h3>
    <table>
      <tr><th>Component</th><th>Library</th></tr>
      <tr><td>Framework</td><td>PyTorch 2.x</td></tr>
      <tr><td>Backbone</td><td>timm (Swin V2)</td></tr>
      <tr><td>Panoptic Head</td><td>detectron2 / custom</td></tr>
      <tr><td>Text Encoder ğŸ†•</td><td>open_clip (BiomedCLIP)</td></tr>
      <tr><td>Report LLM ğŸ†•</td><td>transformers (BioMistral-7B + LoRA)</td></tr>
      <tr><td>Medical I/O</td><td>nibabel, SimpleITK</td></tr>
      <tr><td>Augmentations</td><td>albumentations, MONAI</td></tr>
      <tr><td>Metrics</td><td>torchmetrics, rouge-score, bert-score</td></tr>
      <tr><td>Tracking</td><td>wandb</td></tr>
      <tr><td>Training</td><td>PyTorch Lightning</td></tr>
    </table>
  </div>
</section>

</div>

<footer>
  <p>ğŸ§  SymPanICH-Net v2 â€” Final Year Project | Team-10 | MIT, Anna University</p>
  <p style="margin-top:.5rem;opacity:.6">Supervisor: Dr. J. Dhalia Sweetlin, Dept. of IT</p>
</footer>

<script>
mermaid.initialize({
  startOnLoad:true,
  theme:'dark',
  themeVariables:{
    primaryColor:'#4f46e5',primaryTextColor:'#e2e8f0',primaryBorderColor:'#6366f1',
    lineColor:'#818cf8',secondaryColor:'#1e1b4b',tertiaryColor:'#1a1a2e',
    fontFamily:'Inter',fontSize:'13px',
    edgeLabelBackground:'#1a2035'
  },
  flowchart:{curve:'basis',padding:15,htmlLabels:true,useMaxWidth:true}
});
function scrollTo_(id){document.querySelector(id)?.scrollIntoView({behavior:'smooth',block:'start'})}
// Active nav tracking
const observer=new IntersectionObserver(entries=>{entries.forEach(e=>{if(e.isIntersecting){document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));document.querySelector(`.nav-btn[onclick*="${e.target.id}"]`)?.classList.add('active')}})},{threshold:.3});
document.querySelectorAll('section[id]').forEach(s=>observer.observe(s));
</script>
</body>
</html>
